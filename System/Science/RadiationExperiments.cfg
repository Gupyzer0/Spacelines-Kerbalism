// ============================================================================
// Cosmic Rays Experiment
// ============================================================================

// ----------------------------------------------------------------------------
// Experiment Values
// ----------------------------------------------------------------------------

@KERBALISM_EXPERIMENT_VALUES:NEEDS[FeatureScience]
{
	%SPACELINES
	{
		Spacelines_GeigerCounter
		{
			ECCost = 0.05	
			size = 0.075 						
			value = 3 
			SetupMass =
			SetupCost =			
			duration = 180
			UnlockTech = 
			requirements =
			ResourceRates =
			CrewRequirement =
		}
		Spacelines_CosmicRay
		{
			ECCost = 0.05
			size = 0.25 						
			value = 3
			SetupMass =
			SetupCost =								
			duration = 600
			UnlockTech = science3
			requirements =
			ResourceRates =
			CrewRequirement = 
		}
		Spacelines_IonTrap
        {
            ECCost = 0.05	
			size = 4.5 						
			value = 5						
			SetupMass =
			SetupCost =			
			duration = 10800
			UnlockTech = science4
			requirements =
			ResourceRates =
			CrewRequirement =
        }
		Spacelines_TrappedRadiation 
		{
			ECCost = 0.05	
			size = 27 						
			value = 7						
			SetupMass =
			SetupCost =			
			duration = 64800
			UnlockTech = science6
			requirements =
			ResourceRates =
			CrewRequirement =
		}
	}
}

// ----------------------------------------------------------------------------
// Science Definitions 
// ----------------------------------------------------------------------------

EXPERIMENT_DEFINITION
{
	id = Spacelines_GeigerCounter
	title = Geiger Counter

	scienceCap = 3
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
		default = The cosmic ray radiation data from the Geiger-Muller tube is recorded.
	}

	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0

        VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

        Situation = Surface
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow@VirtualBiomes
		Situation = InSpaceHigh@VirtualBiomes
	}
}

EXPERIMENT_DEFINITION
{
	id = Spacelines_CosmicRay
	title = Geiger Counter

	scienceCap = 3
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
		default = You detect cosmic rays originating both from Kerbol and from outside of the solar system.
		default = The cosmic ray instrument scans for high-energy protons and atomic nuclei.
		default = The instrument records high-energy cosmic ray particles moving near the speed of light.
	}

	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0

        VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

        Situation = Surface
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow@VirtualBiomes
		Situation = InSpaceHigh@VirtualBiomes
	}
}

EXPERIMENT_DEFINITION
{
	id = Spacelines_IonTrap
	title = Ion Trap Experiment

	scienceCap = 5
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
		default = You measure the charged particles that pass through the trap.
	}

	KERBALISM_EXPERIMENT
	{
		VirtualBiome = NoBiome
		VirtualBiome = InnerBelt
		VirtualBiome = OuterBelt
		VirtualBiome = Magnetosphere
		VirtualBiome = Storm
		VirtualBiome = Interstellar
		
		Situation = Space@VirtualBiomes
	}
}

EXPERIMENT_DEFINITION
{
	id = Spacelines_TrappedRadiation
	title = Trapped Radiation Data
	
	scienceCap = 7
	baseValue = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/value$
	dataScale = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/size$
	@dataScale /= #$baseValue$

	RESULTS
	{
		default = You collect data on trapped belts of ions and electrons.
		default = You analyze the flow of charged particles and the belts they are confined to. 
		default = This instrument searches for radiation belt formations.
	}
	
	KERBALISM_EXPERIMENT
	{
		// sample mass in tons. if undefined or 0, the experiment produce a file
		SampleMass = 0
	
		VirtualBiome = NoBiome
		VirtualBiome = Magnetosphere
        VirtualBiome = Storm
        VirtualBiome = OuterBelt
        VirtualBiome = InnerBelt
        VirtualBiome = Interstellar

        Situation = Surface
		Situation = FlyingLow
		Situation = FlyingHigh
		Situation = InSpaceLow@VirtualBiomes
		Situation = InSpaceHigh@VirtualBiomes
	}
}

// ----------------------------------------------------------------------------
// Replacing Experiments with our own experiment
// ----------------------------------------------------------------------------
// Modules being replaced:
// -----------------------
// + bd_GeigerCounter
// + bd_cosmicRay
// + bd_TrappedRadiation
// + geigerCounter
// + 
// ----------------------------------------------------------------------------

// Tagging parts
@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_GeigerCounter]]]:NEEDS[FeatureScience] {
	%Spacelines_Radiation_Experiment = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[geigerCounter]]]:NEEDS[FeatureScience] {
	%Spacelines_Radiation_Experiment = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_TrappedRadiation]]]:NEEDS[FeatureScience] {
	%Spacelines_Radiation_Experiment = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[logIonTrap]]]:NEEDS[FeatureScience] {
	%Spacelines_Radiation_Experiment = True
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_cosmicRay]]]:NEEDS[FeatureScience] {
	%Spacelines_Radiation_Experiment = True
}

// Creating Configure
@PART[*]:HAS[#Tag_Spacelines_Bioexp[True]]:NEEDS[FeatureScience]
{
    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_GeigerCounter
    }

    MODULE
    {
        name = Experiment
        experiment_id = Spacelines_CosmicRay
    }

	MODULE
    {
        name = Experiment
        experiment_id = Spacelines_IonTrap
    }

	MODULE
    {
        name = Experiment
        experiment_id = Spacelines_TrappedRadiation
    }
    
    MODULE
	{
		name = Configure
		title = Radiation Experiments
		slots = 1
		reconfigure = false

        SETUP
        {
            name = Geiger Muller Counter
            desc = Geiger Muller Counter

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_GeigerCounter
			}
        }

        SETUP
        {
            name = Cosmic Rays Detector
            desc = Cosmic Rays Detector

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_CosmicRay
			}
        }

		SETUP
        {
            name = Ion Trap
            desc = Ion Trap

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_IonTrap
			}
        }

		SETUP
        {
            name = Trapped Radiation Detector
            desc = Trapped Radiation Detector

            MODULE
			{
				type = Experiment
				id_field = experiment_id
				id_value = Spacelines_TrappedRadiation
			}
        }
    }
}

// Experiments values
@PART[*]:HAS[@MODULE[Configure]:HAS[#title[Radiation?Experiments]]]:NEEDS[FeatureScience]
{
	@MODULE[Configure]:HAS[#title[Radiation?Experiments]]
	{
		@SETUP:HAS[#name[Geiger?Muller?Counter]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/UnlockTech
		}

		@SETUP:HAS[#name[Cosmic?Rays?Detector]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/UnlockTech
		}

		@SETUP:HAS[#name[Ion?Trap]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/UnlockTech
		}

		@SETUP:HAS[#name[Trapped?Radiation?Detector]]
		{
			cost = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/SetupCost
            mass = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/SetupMass
            tech = #$../../@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/UnlockTech
		}
	}
		
	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_GeigerCounter]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_GeigerCounter/size$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_CosmicRay]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_CosmicRay/size$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_IonTrap]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_IonTrap/size$
	}

	@MODULE[Experiment]:HAS[#experiment_id[Spacelines_TrappedRadiation]]
	{
		%ec_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/ECCost$
		%crew_operate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/CrewRequirement$
		%requires = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/requirements$
		%data_rate = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/size$
		@data_rate /= #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/duration$
		%resources = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/ResourceRates$

		%experimentLength = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/duration$
		%experimentSize = #$@KERBALISM_GROUP_SETTINGS/SPACELINES/Spacelines_TrappedRadiation/size$
	}
}

// ----------------------------------------------------------------------------
// Animations
// ----------------------------------------------------------------------------
@PART[*]:HAS[@MODULE:HAS[#Spacelines_Radiation_Experiment[True]],@MODULE:HAS[#animationName]]:NEEDS[FeatureScience]
{
	@MODULE[Experiment],*
	{
		%anim_deploy = #$../MODULE:HAS[#animationName,~name[Experiment]]/animationName$
	}
}

// ----------------------------------------------------------------------------
// Cleaning old science modules
// ----------------------------------------------------------------------------

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[geigerCounter]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[geigerCounter]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_GeigerCounter]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_GeigerCounter]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_cosmicRay]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_cosmicRay]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[logIonTrap]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[logIonTrap]] {}
}

@PART[*]:HAS[@MODULE[*ModuleScience*]:HAS[#experimentID[bd_TrappedRadiation]]]:FOR[KerbalismDefault]:NEEDS[FeatureScience] {
    !MODULE[*ModuleScience*]:HAS[#experimentID[bd_TrappedRadiation]] {}
}
